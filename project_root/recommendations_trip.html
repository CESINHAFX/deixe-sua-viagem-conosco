<!DOCTYPE html>
<!-- Define o idioma do documento como Português do Brasil -->
<html lang="pt-BR">
<head>
  <!-- Configurações básicas de codificação e viewport -->
  <meta charset="UTF-8">                                           <!-- Garante suporte a caracteres especiais -->
  <meta name="viewport" content="width=device-width,initial-scale=1"> <!-- Configuração para responsividade mobile -->
  
  <!-- Título da página que aparece na aba do navegador -->
  <title>About Us - Leave Your Trip to Us</title>
  
  <!-- Importação de estilos CSS -->
  <link rel="stylesheet" href="styles.css">                       <!-- Estilos principais do site -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins&display=swap" rel="stylesheet"> <!-- Fontes personalizadas do Google -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"> <!-- Biblioteca de ícones -->
  
  <!-- Scripts JavaScript necessários -->
  <script src="js/page-transitions.js" defer></script>            <!-- Sistema de transições de página (carregamento defer) -->
  <script src="js/fragments.js" defer></script>
    <script>
      // If the page was opened via file://, show a visible notice with a link
      // to the local dev server so users can open the same page over HTTP.
      if (location.protocol === 'file:') {
        try {
          const container = document.createElement('div');
          container.setAttribute('role', 'alert');
          container.style.cssText = 'position:fixed;left:12px;top:12px;right:12px;padding:14px 16px;background:#fff3cd;border:1px solid #ffeeba;color:#222;z-index:2147483647;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,0.08);';
          const linkHttp = 'http://127.0.0.1:5500' + location.pathname.replace(/^.*[\\/]/, '/');
          container.innerHTML = `AVISO: você abriu a página via <code>file://</code>. Módulos ES e fetch() são bloqueados. Abra via <a href="${linkHttp}">${linkHttp}</a> ou <a href="http://localhost:5500${location.pathname.replace(/^.*[\\/]/, '/')}">http://localhost:5500${location.pathname.replace(/^.*[\\/]/, '/')}</a> (inicie o servidor com <code>python -m http.server 5500</code> ou Live Server).`;
          const closeBtn = document.createElement('button');
          closeBtn.textContent = 'Fechar';
          closeBtn.style.cssText = 'margin-left:12px;padding:4px 8px;border-radius:4px;border:1px solid rgba(0,0,0,0.06);background:white;cursor:pointer;';
          closeBtn.addEventListener('click', () => container.remove());
          container.appendChild(closeBtn);
          document.addEventListener('DOMContentLoaded', () => document.body.appendChild(container));
        } catch (e) {
          // ignore errors when running in very restricted environments
        }
      }
    </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script> <!-- Biblioteca para busca fuzzy -->
  <script type="module" src="js/search.js"></script>               <!-- Script de busca personalizado -->
</head>
<body>
<div class="bg-wrapper"></div>

<div id="shared-header"></div>
    <!-- Conteúdo específico da página -->
  <main>
    <div>
      <section class="recommendation-trip-section">
        <div class="recommendation-statics-beach-food">
          <h4>Explore your 
          next destination at</h4>
          <article class="recommendations-info">

            <p>It encourages you to explore of unfamiliar 
              territories, embracing diverse cultures and 
              landscapes, while pursuing the desired 
              destination that captivates the heart and
              ignites a sense of wonder.</p>
          </article>
        </div>
        <div class="recommendation-cities-list">
          <h5>Recommended Cities</h5>
              <div id="cities-recommendation-list-static" class="cities-recommendation">
                <div class="recommendation-card">
                  <img src="images/Copilot_20251027_052534.png" alt="Rio de Janeiro" onerror="this.src='images/placeholder.svg'">
                  <div class="recommendation-card-content">
                    <h3>Rio de Janeiro, Brazil</h3>
                    
                    <p>Experience Rio's vibrant spirit. Highlights: carnival celebrations, Christ the Redeemer,
                      Copacabana and Ipanema beaches, samba dancing, Sugarloaf Mountain cable car, and
                      Tijuca National Park.</p>
                  </div>
                </div>

                <div class="recommendation-card">
                  <img src="images/Copilot_20251027_052544.png" alt="Tokyo, Japan" onerror="this.src='images/placeholder.svg'">
                  <div class="recommendation-card-content">
                    <h3>Tokyo, Japan</h3>
                   
                    <p>Immerse in Tokyo's unique blend of tradition and future. Attractions: ancient temples,
                      modern Shibuya crossing, anime culture in Akihabara, sushi at Tsukiji, cherry blossoms in Ueno Park, and shopping in Harajuku.</p>
                  </div>
                </div>
              </div>
        </div>
      </section>
<script>


function runFragmentScripts(container) {
  // Busca todos os elementos <script> dentro do container
  const scripts = container.getElementsByTagName('script');
  const recommendationsContainer = document.getElementById('cities-recommendation-list-static');
  const searchButton = document.getElementById('btnSearch');


  if(searchButton)
    searchButton.addEventListener("click", () =>{
      console.log("searchButton existe");
    });

  if(recommendationsContainer)
    recommendationsContainer.addEventListener("click", () =>{
    console.log("containeir existe");
    });

  recommendationsContainer.textContent = 'Rio de janeiro, Brazil' + "Tokyo, Japan"; 
  // Itera sobre cada script encontrado
  Array.from(scripts).forEach(script => {
    // Cria um novo elemento <script> para reexecução
    const newScript = document.createElement('script');
    
    // Copia todos os atributos do script original (src, type, etc)
    Array.from(script.attributes).forEach(attr => {
      newScript.setAttribute(attr.name, attr.value);
    });
    
    // Copia o conteúdo interno do script (código JavaScript)
    newScript.textContent = script.textContent;
    
    // Substitui o script original pelo novo (força reexecução)
    script.parentNode.replaceChild(newScript, script);
  });
}

    // carrega um fragmento HTML e injeta no container especificado
    function loadFragment(url, containerId) {
      fetch(url)
        .then(function(response) {
          if (!response.ok) throw new Error('Network response was not ok: ' + response.status);
          return response.text();
        })
        .then(function(html) {
          var container = document.getElementById(containerId);
          if (!container) return;
          container.innerHTML = html;
          markActiveLink(container);
          runFragmentScripts(container); // Agora esta função existe
          // Adiciona os event listeners após carregar o header
          if (containerId === 'shared-header') {
            setupHeaderButtons();
          }
        })
        .catch(function(err) {
          console.error('Erro ao carregar fragmento:', err);
        });
    }

    // Busca o container de recomendações
    const recommendationsContainer = document.getElementById('cities-recommendation-list-static');
    // Busca o botão de busca
    const searchButton = document.getElementById('btnSearch');
     //3. Anexar o ouvinte de evento ao botão de busca
    if (searchButton && recommendationsContainer) {
      searchButton && recommendationsContainer.addEventListener("click", () => {
        console.log("searchButton existe e recommendations container");
      //// O tipo de evento é 'click'
      searchButton.addEventListener("click", function(event) {
        //// Altera o conteúdo do container de recomendações para 'resultsContainer' que vai ser definido na linha 262
        recommendationsContainer.textContent = "results";
      })
      });
    }
      
      
      

    function markActiveLink(container) {
      try {
        var containerEl = typeof container === 'string' ? document.getElementById(container) : container;
        if (!containerEl) return;
        var links = containerEl.querySelectorAll('a[href]'); 
       
        var current = window.location.pathname.split('/').pop() || 'index.html';
        links.forEach(function(a) {
          var href = (a.getAttribute('href') || '').split('/').pop();
          if (href === current) a.classList.add('active');
        });
    
        
      } catch (e) {
        console.error("markActiveLink error:", e);
      }
    }
    

            
    // aplica classe .active ao link que corresponde à página atual
    
    
    // configura os botões do header
    // Add this helper function for text normalization
/**
 * Normaliza texto para busca removendo acentos e padronizando caracteres
 * @param {string} text - Texto a ser normalizado
 * @returns {string} Texto normalizado em minúsculas, sem acentos e espaços extras
 */
function normalizeText(text) {
  // Validação de entrada para evitar erros
  if (!text || typeof text !== 'string') {
    return '';
  }
  
  return text
    .toLowerCase()                // Converte para minúsculas
    .trim()                      // Remove espaços no início e fim
    .normalize('NFD')            // Decompõe caracteres acentuados
    .replace(/[\u0300-\u036f]/g, ''); // Remove diacríticos (acentos)
}

/**
 * Configura os botões de busca e suas funcionalidades
 * Implementa a lógica de busca fuzzy usando Fuse.js
 * 
 */
let headerInitialized = false; // Flag para evitar múltiplas inicializações
function setupHeaderButtons() {
  if (headerInitialized) {
    console.log('[DEBUG] Header already initialized, ignorando');
    return; // Evita inicializações duplicadas
  }
  headerInitialized = true;
  const searchBtn = document.getElementById('btnSearch');   // Botão de busca
  const cleanBtn = document.getElementById('clean');        // Botão para limpar busca
  const searchInput = document.getElementById('Research');  // Campo de entrada da busca
  const resultsContainer = document.getElementById('results');

  // Protege contra elementos não encontrados
  if (searchBtn && searchInput) {
    searchBtn.addEventListener('click', async () => {
      console.log('[DEBUG] Clique no botão Search detectado');
      if (!searchInput.value) return;

      console.log('[DEBUG] Iniciando busca por:', searchInput.value);
      try {
        const results = await searchDatabase(normalizeText(searchInput.value));
        displayRecommendations(results);
      } catch (error) {
        console.error('Search failed:', error);
        showErrorMessage();
        hearderInitialized = true; // Reset flag on error
      }
    });
  }

  if (cleanBtn && searchInput) {
    cleanBtn.addEventListener('click', () => {
      searchInput.value = '';
      clearSearchResults();
    });
  }
}

/**
 * Funções auxiliares para processamento dos resultados da busca
 */

/**
 * Agrupa os resultados da busca por categoria (países, templos, praias)
 * @param {Array} results - Resultados brutos da busca com Fuse.js
 * @returns {Object} Objeto com arrays separados por categoria
 */
function groupSearchResults(results) {
  // Inicializa objeto para armazenar resultados agrupados
  const grouped = {
    countries: [],    // Array para armazenar países encontrados
    temples: [],      // Array para armazenar templos encontrados
    beaches: []       // Array para armazenar praias encontradas
  };

  results.forEach(result => {
    const { item, score } = result;
    
    if (item.countries) {
      grouped.countries.push(...item.countries);
    }
    if (item.temples) {
      grouped.temples.push(...item.temples);
    }
    if (item.beaches) {
      grouped.beaches.push(...item.beaches);
    }
  });

  return grouped;
}

/**
 * Exibe os resultados da busca na interface do usuário
 * @param {Object} results - Resultados agrupados por categoria
 */
function displaySearchResults(results) {
  // Busca ou cria o container para exibir resultados
  let resultsContainer = document.getElementById('search-results');
  // Se o container não existir, cria um novo
  if (!resultsContainer) {
    resultsContainer = document.createElement('div');
    resultsContainer.id = 'search-results';
    document.querySelector('main').appendChild(resultsContainer);
  }

  resultsContainer.innerHTML = `
    <div class="results-grid">
      ${Object.entries(results).map(([category, items]) => `
        <div class="category-section">
          <h3>${category.charAt(0).toUpperCase() + category.slice(1)}</h3>
          <div class="items-grid">
            ${items.map(item => `
              <div class="result-card">
                 <img src="${item.imageUrl || './images/placeholder.svg'}" 
                   alt="${item.name || 'Image'}"
                   onerror="this.onerror=null; this.src='./images/placeholder.svg';">
                <h4>${item.name || 'Unnamed Location'}</h4>
                <p>${item.description || 'No description available'}</p>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

/**
 * Limpa os resultados da busca da interface
 * Chamado quando o usuário limpa o campo de busca ou inicia nova busca
 */
function clearSearchResults() {
  // Busca o container de resultados
  const resultsContainer = document.getElementById('search-results');
  // Se existir, limpa seu conteúdo
  if (resultsContainer) {
    resultsContainer.innerHTML = '';
  }
}

/**
 * Mapeamento de termos em português para inglês e categorias relacionadas
 * Usado para melhorar a busca com sinônimos e termos relacionados
 * @constant {Object}
 */
//O AJAX JA LIDA COM ERROS DE DIGITAÇÃO OU ACENTO, PLURAL AUTOMATICO ?ENTAO N PRECISA DISSO
const termMapper = {
  // Mapeamento direto português-inglês
  'praia': 'beach',     // Termo singular
  'praias': 'beach',    // Termo plural
  'templo': 'temple',   // Termo singular
  'templos': 'temples', // Termo plural
  'pais': 'country',
  'paises': 'countries',
  'carnaval': ['Rio de Janeiro', 'Brazil', 'festival'],
  'samba': ['Rio de Janeiro', 'Brazil', 'culture'],
  'surf': ['beach', 'water sports'],
  'mergulho': ['beach', 'diving', 'water sports'],
  'historia': ['temple', 'culture', 'history'],
  'cultura': ['temple', 'culture', 'history'],
  'relaxar': ['beach', 'spa', 'resort'],
  'aventura': ['nature', 'wildlife', 'sports'],
  'natureza': ['nature', 'wildlife', 'park'],
  'cidade': ['urban', 'city'],
  'compras': ['urban', 'shopping'],
  'gastronomia': ['food', 'culture']
};

  

    // comportamento do botão hero: rolar até o footer
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'more-informations') {
        var footer = document.getElementById('shared-footer');
        if (footer) footer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });

    // comportamento dos botões do header (search / reset) - exemplo simples
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'btnSearch') {
        var q = document.getElementById('Research') ? document.getElementById('Research').value : '';
        alert('Pesquisar por: ' + q);
      }
      if (e.target && e.target.id === 'clean') {
        if (document.getElementById('Research')) document.getElementById('Research').value = '';
      }
    });
</script>
    
  </section>
  </main>

<!-- header compartilhado será injetado aqui -->
<div id="shared-header"></div>


  <!-- footer compartilhado será injetado aqui -->
  <div id="shared-footer"></div>

  <script>
   
        document.addEventListener('click', function (e) {
            if (e.target && e.target.id === 'more-informations') {
                var footer = document.getElementById('shared-footer');
                if (footer) footer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        // comportamento dos botões do header (search / reset)
        document.addEventListener('click', function (e) {
            if (e.target && e.target.id === 'btnSearch') {
                var q = document.getElementById('Research') ? document.getElementById('Research').value : '';
                alert('Pesquisar por: ' + q);
            }
            if (e.target && e.target.id === 'clean') {
                if (document.getElementById('Research')) document.getElementById('Research').value = '';
            }
        });

        // Load shared header/footer usando loadFragment definido em js/fragments.js
        if (typeof loadFragment === 'function') {
            // use consistent relative paths (fragments/...) so fragments.fetchWithVariants can resolve variants reliably
            loadFragment('fragments/header.html', 'shared-header', () => {
                try {
                    if (typeof window.setupHeaderButtons === 'function') {
                        window.setupHeaderButtons();
                    }
                } catch (e) { console.error('setupHeaderButtons callback error', e); }
            });
            loadFragment('fragments/footer.html', 'shared-footer');
        } else {
            console.warn('loadFragment não disponível. Verifique se js/fragments.js foi carregado corretamente.');
        }


 </script>

</body>
</html>


